import os
import sys

from src.crawler import crawler
from src import pepaser

from config.proj import SRC_DIR

def main(argv):
  all_task = [ f.split('.')[0] for f in os.listdir(SRC_DIR) if os.path.isfile(os.path.join(SRC_DIR, f)) and not f.startswith('__')]

  argv.pop(0) # pop manage.py

  if not argv:
    print("<Usage> {}".format(', '.join(all_task)))
    return


  task_name = argv[0] # ex: crawler

  if task_name in all_task:

    src_dir = os.path.relpath(SRC_DIR)

    task = import_from('{}.{}'.format(src_dir, task_name), task_name)

    task(argv)

  else:
    print("<Usage> {}".format(', '.join(all_task)))

  return

def import_from(module, name):
  module = __import__(module, fromlist=[name])
  return getattr(module, name)

if __name__ == '__main__':
  main(sys.argv)
