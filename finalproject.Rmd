---
title: "finalproject"
author: "team_22"
date: "January 9, 2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
complete_data <- read.csv('csv/complete_data_noimpt.csv', row.names = 1)
pe_list <- rownames(complete_data)
ttl_ft_list <- colnames(complete_data)
hdr_ft_list <- ttl_ft_list[1:23]
imp_ft_list <- ttl_ft_list[25:length(ttl_ft_list)]

complete_data$MalFlag <- as.factor(complete_data$MalFlag)
summary_data <- summary(complete_data)
```

```{r}
sub <- sample(nrow(complete_data), floor(nrow(complete_data) * 0.75))
training_data <- complete_data[sub, ]
testing_data <- complete_data[-sub, ]

training_data.hdr = training_data[c(hdr_ft_list, "MalFlag")]
training_data.imp = training_data[c(imp_ft_list, "MalFlag")]

testing_data.hdr = testing_data[c(hdr_ft_list)]
testing_data.imp = testing_data[c(imp_ft_list)]
testing_data.label = testing_data$MalFlag
```

```{r}
pred_report = data.frame(row.names = c("Logistic Regression", "KNN", "Random Forest", "SVM"))
```

### Use the features only in the Header Table

#### Learning Model : Logistic Regression
```{r}
glm_model <- glm(formula= MalFlag ~ ., data=training_data.hdr, family="binomial")
glm_pred <- predict(glm_model, testing_data.hdr)
glm_pred <- as.vector(glm_pred)
```

```{r}
threshold = 0.5
glm_pred_c = vector(length = length(glm_pred))
glm_pred_c[glm_pred>threshold] <- 1
glm_pred_c[glm_pred<=threshold] <- 0

#mean(pred == testing_data.label)
```

#### Learning Model : KNN
```{r}
library(class)
```

```{r}
knn.1  <- knn(training_data.hdr[1:23], testing_data.hdr, training_data.hdr$MalFlag, k=1 )
knn.10 <- knn(training_data.hdr[1:23], testing_data.hdr, training_data.hdr$MalFlag, k=10)
knn.25 <- knn(training_data.hdr[1:23], testing_data.hdr, training_data.hdr$MalFlag, k=25)
```

```{r}
acc.knn.1  <- mean(knn.1  == testing_data.label)
acc.knn.10 <- mean(knn.10 == testing_data.label)
acc.knn.25 <- mean(knn.25 == testing_data.label)
```

```{r}
#acc.knn.1
#acc.knn.10
#acc.knn.25
```

#### Learning Model : Random Forest
```{r}
library(randomForest)
```

```{r}
rdf_model <- randomForest(formula = MalFlag ~ ., data=training_data.hdr, ntree=25)
rdf_pred <- predict(rdf_model, testing_data.hdr)
rdf_pred <- as.vector(rdf_pred)
```

```{r}
#mean(rdf_pred == testing_data.label)
```

#### Learning Model : SVM
```{r}
library("e1071")
```

```{r}
svm_model <- svm(formula = MalFlag ~ ., data=training_data.hdr, cross=10)
svm_pred <- predict(svm_model, testing_data.hdr)
svm_pred <- as.vector(svm_pred)
```

```{r}
#mean(svm_pred == testing_data.label)
```


```{r}
acc <- c(mean(glm_pred_c == testing_data.label),
         mean(c(acc.knn.1, acc.knn.10, acc.knn.25)),
         mean(rdf_pred == testing_data.label),
         mean(svm_pred == testing_data.label))

pred_report$HeaderTable <- acc
```

### Use the features only in the Import Table

#### Learning Model : Logistic Regression
```{r}
glm_model <- glm(formula= MalFlag ~ ., data=training_data.imp, family="binomial")
glm_pred <- predict(glm_model, testing_data.imp)
glm_pred <- as.vector(glm_pred)
```

```{r}
threshold = 0.5
glm_pred_c = vector(length = length(glm_pred))
glm_pred_c[glm_pred>threshold] <- 1
glm_pred_c[glm_pred<=threshold] <- 0

#mean(glm_pred_c == testing_data.label)
```

#### Learning Model : KNN
```{r}
library(class)
```
<span style="color:red">
error
</span>
```{r}
knn.1  <- knn(training_data.imp[1:675], testing_data.imp, training_data.imp$MalFlag, k=1 )
knn.10 <- knn(training_data.imp[1:675], testing_data.imp, training_data.imp$MalFlag, k=10)
knn.25 <- knn(training_data.imp[1:675], testing_data.imp, training_data.imp$MalFlag, k=25)
```

```{r}
acc.knn.1  <- mean(knn.1  == testing_data.label)
acc.knn.10 <- mean(knn.10 == testing_data.label)
acc.knn.25 <- mean(knn.25 == testing_data.label)
```

```{r}
#acc.knn.1
#acc.knn.10
#acc.knn.25
```

#### Learning Model : Random Forest
```{r}
library(randomForest)
```

```{r}
rdf_model <- randomForest(formula = MalFlag ~ ., data=training_data.imp, ntree=25)
rdf_pred <- predict(rdf_model, testing_data.imp)
rdf_pred <- as.vector(rdf_pred)
```

```{r}
#mean(rdf_pred == testing_data.label)
```

#### Learning Model : SVM
```{r}
library("e1071")
```

```{r}
svm_model <- svm(formula = MalFlag ~ ., data=training_data.imp, cross=10)
svm_pred <- predict(svm_model, testing_data.imp)
svm_pred <- as.vector(svm_pred)
```

```{r}
#mean(svm_pred == testing_data.label)
```


```{r}
acc <- c(mean(glm_pred_c == testing_data.label),
         "NA",
         mean(rdf_pred == testing_data.label),
         mean(svm_pred == testing_data.label))

pred_report$ImportTable <- acc
```

### Use the complete features
#### Learning Model : Logistic Regression
```{r}
fts = c(hdr_ft_list, imp_ft_list)
```

```{r}
glm_model <- glm(formula= MalFlag ~ ., data=training_data, family="binomial")
glm_pred <- predict(glm_model, testing_data[fts])
glm_pred <- as.vector(glm_pred)
```

```{r}
threshold = 0.5
glm_pred_c = vector(length = length(glm_pred))
glm_pred_c[glm_pred>threshold] <- 1
glm_pred_c[glm_pred<=threshold] <- 0

#mean(pred == testing_data.label)
```

#### Learning Model : KNN
```{r}
library(class)
```
<span style="color:red">
execution time is too long
</span>
```{r}
#knn.1  <- knn(training_data[fts], testing_data[fts], training_data$MalFlag, k=1 )
#knn.10 <- knn(training_data[fts], testing_data[fts], training_data$MalFlag, k=10)
#knn.25 <- knn(training_data[fts], testing_data[fts], training_data$MalFlag, k=25)
```

```{r}
#acc.knn.1  <- mean(knn.1  == testing_data.label)
#acc.knn.10 <- mean(knn.10 == testing_data.label)
#acc.knn.25 <- mean(knn.25 == testing_data.label)
```

```{r}
#acc.knn.1
#acc.knn.10
#acc.knn.25
```

#### Learning Model : Random Forest
```{r}
library(randomForest)
```

```{r}
rdf_model <- randomForest(formula = MalFlag ~ ., data=training_data, ntree=25)
rdf_pred <- predict(rdf_model, testing_data[fts])
rdf_pred <- as.vector(rdf_pred)
```

```{r}
#mean(rdf_pred == testing_data.label)
```

#### Learning Model : SVM
```{r}
library("e1071")
```

```{r}
svm_model <- svm(formula = MalFlag ~ ., data=training_data, cross=10)
svm_pred <- predict(svm_model, testing_data[fts])
svm_pred <- as.vector(svm_pred)
```

```{r}
#mean(svm_pred == testing_data.label)
```


```{r}
acc <- c(mean(glm_pred_c == testing_data.label),
         "time out",
         mean(rdf_pred == testing_data.label),
         mean(svm_pred == testing_data.label))

pred_report$CompleteFeature <- acc
```
