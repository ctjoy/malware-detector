import argparse
import subprocess
import os

def create_arg(argv):
    argment = argparse.ArgumentParser()
    argment.add_argument('-d', required=True)
    argment.add_argument('-p', required=True)
    return argment.parse_args(argv[1:])

def unzip_dir(argv):
    args = create_arg(argv)

    d_is_dir = os.path.isdir(args.d)
    p_is_dir = os.path.isdir(args.p)
    
    if not d_is_dir:
        print ("args.d: {0} is not a directory".format(args.d))
    if not p_is_dir:
        print ("args.p: {0} is not a directory".format(args.p))
    if not d_is_dir or not p_is_dir:
        return -1
    
    print ("**Input  dir is : {}**".format(args.d))
    print ("**Output dir is : {}**".format(args.p))
    if not input("Do you want to continue?[y/n]") in "Yy":
        return -1

    all_zip = [f for f in os.listdir(args.d)
                if os.path.isfile(os.path.join(args.d, f))
                    and f.endswith('.zip')]

    for f in all_zip:
        filename = os.path.join(args.d, f)
        out_dirname = os.path.join(args.p, f.split('.')[0])
        if subprocess.call(['unzip', filename, '-d', out_dirname]) != 0:
            print ("[My]Fail unzip {} to {}".format(filename, out_dirname))
    return
