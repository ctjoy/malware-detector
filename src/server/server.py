import os

from bottle import Bottle, template, static_file, run, request


SERVER_DIR = os.path.dirname(os.path.abspath(__file__))
PUBLIC_DIR = os.path.join(SERVER_DIR, 'public')
UPLOAD_DIR = os.path.join(SERVER_DIR, 'upload')

app = Bottle()

@app.route('/')
def index():
    return template('index')

@app.route('/detect/', method='POST')
def detect():
    detect_file = request.files.get('detect-file')
    file_path = os.path.join(UPLOAD_DIR, detect_file.filename)
    detect_file.save(file_path)
    return template('detect', name=detect_file.filename)

@app.route('/static/<path:path>')
def static(path):
    return static_file(path, root=PUBLIC_DIR)

run(app, host="0.0.0.0", port=8800)
